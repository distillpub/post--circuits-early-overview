<html>
<head>
  <script src="https://distill.pub/template.v2.js"></script>
  <meta charset="utf-8" />
  <link rel="stylesheet" type="text/css" href="index.css">
  <title>An Overview of Early Vision in InceptionV1</title>
  <script  type="text/javascript">
  function toggle_collapse() {{
    var className = event.target.parentNode.className;
    if (className.includes("collapsed")){{
      event.target.parentNode.className = className.replace("collapsed", "")
    }} else {{
      event.target.parentNode.className = className + " collapsed";
    }}
  }}
  </script>
</head>

<d-front-matter>
    <script type="text/json">{{
      "title": "",
      "description": "",
      "password": "circuits",
      "authors": [
        {{
          "author": "Authors TBD",
          "authorURL": "",
          "affiliation": "OpenAI",
          "affiliationURL": "https://openai.com"
        }}
      ]
    }}</script>
  </d-front-matter>

<d-title>
<h1 style='font-size: 240%; grid-column-start: text; grid-column-end: page;'>An Overview of Early Vision in InceptionV1</h1>
<p style='font-size:  150%; line-height: 140%; margin-top: 10px;'>A guided tour of the first five layers of InceptionV1,<br> taxonomized into "neuron groups."</p>
</d-title>
<d-byline></d-byline>

<d-article>

  <section id="thread-nav" class="thread-info" style="grid-column-start: text; grid-column-end: text; margin-top: 20px; margin-bottom: 80px;">
      <div class="icon-multiple-pages"></div>
      <p class="explanation">
          This article is part of the <a style="border-bottom: none; color: #2e6db7; margin-left: 0px;" href="https://distill.pub/2020/circuits/">Circuits thread</a>, a collection of short articles and commentary by an open scientific collaboration delving into the inner workings of neural networks.<br>
          <!--<a style="border-bottom: none; color: #2e6db7; margin-left: 0px;">ðŸ”¬Learn how to get involved.</a>-->
          <!--<a class="overview" href="#">Thread Overview</a>-->
      </p>

      <a class="prev" href="https://distill.pub/2020/circuits/zoom-in/">Zoom In: An Introduction to Circuits</a>
      <div class="next" href="#" style="color:#999;">Curve Detectors
        <div style="color:#BBB; font-size: 90%; line-height: 140%; margin-top: 4px;">Under discussion in <a href="http://slack.distill.pub/">Distill slack</a> <code>#circuits</code></div>
      </div>
  </section>


<p>
  The first few articles of the Circuits project will be focused on early vision in InceptionV1<d-cite bibtex-key="szegedy2015going"></d-cite>
  -- for our purposes, the five convolutional layers leading up to the third pooling layer.
</p>

<figure class="l-body-outset">
  {images/Early}
  <figcaption style="margin-top:8px;">For our purposes, we'll consider early vision to be the first five layers. Click on a layer to jump to section.</figcaption>
</figure>

<p>
  Over the course of these layers, we see the network go from raw pixels
  up to sophisticated <a href="#group_mixed3b_boundary">boundary detection</a>, basic shape detection
  (eg. <a href="#group_mixed3b_curves">curves</a>, <a href="#group_mixed3b_circles_loops">circles</a>, <a href="#group_mixed3b_curve_shapes">spirals</a>, <a href="#group_mixed3a_angles">triangles</a>),
  <a href="#group_mixed3b_eyes">eye detectors</a>, and even crude detectors for <a href="#group_mixed3b_proto_head">very small heads</a>.
  Along the way, we see a variety of interesting intermediate features,
  including <a href="#conv2d1_discussion_complex_gabor">Complex Gabor detectors</a> (similar to some classic "complex cells" of neuroscience),
  <a href="#mixed3a_discussion_BW">black and white vs color detectors</a>, and <a href="#mixed3a_discussion_small_circle">small circle formation from curves</a>.
</p>

<p>
  Studying early vision has two major advantages as a starting point in our investigation.
  Firstly, it's particularly easy to study:
  it's close to the input, the circuits are only a few layers deep, there aren't that many different neurons,<d-footnote>It's common for vision models to have on the order of 64 channels in their initial convolutional layers, which are applied at many spatial positions. So while there are many neurons, the number of unique neurons is orders of magnitude smaller.</d-footnote> and the features seem quite simple.
  Secondly, early vision seems most likely to be universal: to have the same features and circuits form across different architectures and tasks.
</p>

<p>
  Before we dive into detailed explorations of different parts of early vision, we wanted to give a broader overview of how we presently understand it.
  This article sketches out our understanding, as an annotated collection of what we call "neuron groups."
  We also provide illustrations of selected circuits at each layer.
</p>

<p>
  By limiting ourselves to early vision, this article "only" considers the first 1,056 neurons of InceptionV1.<d-footnote>We will not discuss the "bottleneck" neurons in mixed3a/mixed3b, which we generally think of as low-rank connections to the previous layer.</d-footnote>
  But our experience is that a thousand neurons is more than enough to be disorienting when one begins studying a model.
  Our hope is that this article will help readers avoid this disorientation by providing some structure and handholds for thinking about them.
</p>



<h3 id="cards">Playing Cards with Neurons</h3>

<p>
  Dmitri Mendeleev is often accounted to have discovered the Periodic Table by playing "chemical solitaire," writing the details of each element on a card and patiently fiddling with different ways of classifying and organizing them.
  Some modern historians are skeptical about the cards, but Mendeleev's story is a compelling demonstration of that there can be a lot of value in simply organizing phenomena, even when you don't have a theory or firm justification for that organization yet.
  Mendeleev is far from unique in this.
  For example, in biology, taxonomies of species proceeded genetics and the theory of evolution giving them a theoretical foundation.
</p>

<p>
  Our experience is that many neurons in vision models seem to fall into families of similar features.
  For example, it's not unusual to see a dozen neurons detecting the same feature in different orientations or colors.
  Perhaps even more strikingly, the same "neuron families" seem to recur across models!
  Of course, it's well known that Gabor filters and color contrast detectors reliably comprise neurons in the first layer of convolutional neural networks, but we were quite surprised to see this generalize to later layers.
</p>

<p>
  This article shares our working categorization of units in the first five layers of InceptionV1 into neuron families.
  Our categorization is based on looking at feature visualizations, dataset examples, how a feature is built from the previous layer, how it is used, and other analysis, although it varies in how much attention we've given to an individual neuron.
  We've found these helpful for communicating among ourselves and breaking the problem of understanding InceptionV1 into smaller chunks.
  While there are some families we suspect are "real", many others are categories of convenience, or categories we have low-confidence about.
  The main goal of these families is to help researchers orient themselves.
</p>

<h4>Caveats</h4>

<ul>
  <li>This is a broad overview and our understanding of many of these units is low-confidence.</li>
  <li>Many neuron groups are catch-all categories or convenient organizational categories that we don't think reflect fundamental structure.</li>
  <li>Even for neuron groups we suspect do reflect a fundamental structure (eg. some can be recovered from factorizing the layer's weight matrices) the boundaries of these groups can be blurry and some neurons inclusion involve judgement calls.</li>
</ul>


<h3 id="presentation">Presentation of Neurons</h3>

<p>
  In order to talk about neurons, we need to somehow represent them.
  While we could use neuron indices, it's very hard to keep hundreds of numbers straight in one's head.
  Instead, we use <a href="https://distill.pub/2017/feature-visualization/">feature visualizations</a><d-cite key="erhan2009visualizing,olah2017feature,simonyan2013deep,nguyen2015deep,mordvintsev2015inceptionism,nguyen2016plug"></d-cite>, optimized images which highly stimulate a neuron.<d-footnote>
    Our feature visualization is done with the <a href="https://github.com/tensorflow/lucid">lucid library</a><d-cite key="olah2017feature"></d-cite>.
    We use small amounts of transformation robustness when visualizing the first few layers, because it has a larger proportional affect on their small receptive fields, and increase as we move to higher layers.
    For low layers, we use L2 regularization to push pixels towards gray.
    For the first layer, we follow the convention of other papers and just show the weights, which for the special case of the first layer are equivalent to feature visualization with the right L2 penalty.
  </d-footnote>
</p>
<p>
  When we represent a neuron with a feature visualization, we don't intend to claim that the feature visualization captures the entirety of the neuron's behavior.
  Rather, the role of a feature visualization is like a variable name in understanding a program.
  It replaces an arbitrary number with a more meaningful symbol <d-cite bibtex-key="olah2018building"></d-cite>.
</p>


<br><br>
<hr style="margin-top: 100px; margin-bottom: 100px;">
<br><br>

<h2 id="conv2d0"><code>conv2d0</code></h2>

<p>
  The first conv layer of every vision model we've looked at is mostly comprised of two kinds of features: color-contrast detectors and Gabor filters.
  InceptionV1's <code>conv2d0</code> is no exception to this rule, and most of its units fall into these categories.
</p>

<p>
  In contrast to other models, however, the features aren't perfect color contrast detectors and Gabor filters.
  For lack of a better word, they're messy.
  We have no way of knowing, but it seems likely this is a result of the gradient not reaching the early layers very well during training.
  Note that InceptionV1 predated the adoption of modern techniques like batch norm and Adam, which make it much easier to train deep models well.
</p>

<p>
  One subtlety that's worth noting here is that Gabor filters almost always come in pairs of weights which are negative versions of each other, both in InceptionV1 and other vision models.
  A single Gabor filter can only detect edges at some offsets, but the negative version fills in holes, allowing for the formation of complex Gabor filters in the next layer.
</p>

{conv2d0}




<hr style="margin-top: 80px; margin-bottom: 100px;">
<br><br>

<h2 id="conv2d1"><code>conv2d1</code></h2>

<p>
  In <code>conv2d1</code>, we begin to see some of the classic <a href="https://en.wikipedia.org/wiki/Complex_cell">complex cell</a> features of visual neuroscience.
  These neurons respond to similar patterns to units in <code>conv2d0</code>, but are invariant to some changes in position and orientation.
</p>

<p style="margin-top: 20px;">
  <b id="conv2d1_discussion_complex_gabor">Complex Gabors:</b>
  A nice example of this is the "Complex Gabor" feature family.
  Like simple Gabor filters, complex Gabors detect edges.
  But unlike simple Gabors, they are relatively invariant to the exact position of the edge or which side is dark or light.
  This is achieved by being excited by multiple Gabor filters in similar orientations -- and most critically, by being excited by "reciprocal Gabor filters" that detect the same pattern with dark and light switched.
  This can be seen as an early example of the "union over cases" motif.
</p>

<figure style='image-rendering: pixelated;'>
  {images/ComplexGabors}
  <figcaption style="margin-top: 12px;">All neurons in the previous layer with at least 30% of the max weight magnitude are shown,
    both <span class="positive-text">positive (excitation)</span> and <span class="negative-text">negative (inhibition)</span>.
    Click on a neuron to see its forwards and backwards weights.</figcaption>
</figure>

<p>
  Note that <code>conv2d1</code> is a 1x1 convolution, so there's only a single weight â€” a single line, in this diagram â€” between each channel in the previous and this one.<d-footnote>
    There is a pooling layer between them, so the features it connects to are pooled versions of the previous layer rather than original features.</d-footnote>
  This plays an important role in determining the features we observe: in models with larger convolutions in their second layer, we often see a jump to crude versions of the larger more complex features we'll see in the following layers.
</p>

<p>
  In addition to Complex Gabors, we see a variety of other features, including
  more invariant color contrast detectors, Gabor-like features that are less selective for a single orientation, and lower-frequency features.
</p>

{conv2d1}

<br>
<hr style="margin-top: 20px; margin-bottom: 100px;">
<br><br>

<h2 id="conv2d2"><code>conv2d2</code></h2>

<p>
In <code>conv2d2</code> we see the emergence of very simple shape predecessors.
This layer sees the first units that might be described as "line detectors", preferring a single longer line to a Gabor pattern and accounting for about 25% of units.
We also see tiny curve detectors, corner detectors, divergence detectors, and a single very tiny circle detector.
One fun aspect of these features is that you can see that they are assembled from Gabor detectors in the feature visualizations, with curves being built from small piecewise Gabor segments.
All of these units still moderately fire in response to incomplete versions of their feature, such as a small curve running tangent to the edge detector.
</p>

<p>
Since <code>conv2d2</code> is a 3x3 convolution, our understanding of these shape precursor features (and some texture features) maps to particular ways Gabor and lower-frequency edges are being spatially assembled into new features.
At a high-level, we see a few primary patterns:
</p>

<figure style='grid-column-start: page-start; image-rendering: pixelated;'>
  {images/GaborCombinations}
</figure>

<p>
  We also begin to see various kinds of texture and color detectors start to become a major constituent of the layer, including color-contrast and color center surround features, as well as Gabor-like, hatch, low-frequency and high-frequency textures.
  A handful of units look for different textures on different sides of their receptive field.
</p>

{conv2d2}





<br>
<hr style="margin-top: 20px; margin-bottom: 100px;">
<br><br>

<h2 id="mixed3a"><code>mixed3a</code></h2>

<p>
<code>mixed3a</code> has a significant increase in the diversity of features we observe.
Some of them  -- curve detectors and high-low frequency detectors --
were discussed in <a href="https://distill.pub/2020/circuits/zoom-in/">Zoom In</a>
and will be discussed again in later articles in great detail.
But there are some really interesting circuits in <code>mixed3a</code> which we haven't discussed before,
and we'll go through a couple selected ones to give a flavor of what happens at this layer.
</p>


<p style="margin-top:20px;">
<b id="mixed3a_discussion_BW">Black & White Detectors:</b> One interesting property of <code>mixed3a</code> is the emergence of <a href="#group_mixed3a_bw_vs_color">"black and  white" detectors</a>, which detect the absence of color.
Prior to <code>mixed3a</code>, color contrast detectors look for transitions of a color to near complementary colors (eg. blue vs yellow).
From this layer on, however, we'll often see color detectors which compare a color to the absence of color.
Additionally, black and white detectors can allow the detection of greyscale images, which may be correlated with ImageNet categories (see {neuron/4a/479} which detects black and white portraits).
</p>
<p>
The circuit for our black and white detector is quite simple:
almost all of its large weights are negative, detecting the absence of colors.
  Roughly, it computes <code style="margin-left: 4px;"><b>NOT(</b>color_feature_1 <b>OR</b> color_feature_2 <b>OR</b> ...<b>)</b></code>.
</p>

<figure style='image-rendering: pixelated;'>
  {images/BW}
  <figcaption style="margin-top: 12px;">
    The sixteen strongest magnitude weights to the previous layer are shown.
    For simplicity, only one spatial weight for positive and negative have been shown, but they all have almost identical structure.
    Click on a neuron to see its forwards and backwards weights.</figcaption>
</figure>

<p style="margin-top:20px;">
<b id="mixed3a_discussion_small_circle">Small Circle Detector:</b> We also see somewhat more complex shapes in <code>mixed3a</code>. Of course, curves (which we discussed in <a href="https://distill.pub/2020/circuits/zoom-in/">Zoom In</a>) are a prominent example of this.
But there's lots of other interesting examples.
For instance, we see a variety of <a href="#group_mixed3a_eyes_small_circles">small circle and eye detectors</a> form
by piecing together <a href="#group_conv2d2_tiny_curves">early curves and circle detectors (<code>conv2d2</code>)</a>:
</p>

<figure style='grid-column-start: text-start; image-rendering: pixelated;'>
  {images/SmallCircle}
</figure>

<p style="margin-top:20px;">
  <b id="mixed3a_discussion_triangle">Triangle Detectors:</b> While on the matter of basic shapes, we also see <a href="#group_mixed3a_angles">triangle detectors</a>
  form from earlier <a href="#group_conv2d2_line">line (<code>conv2d2</code>)</a> and <a href="#group_conv2d2_shifted_line">shifted line (<code>conv2d2</code>)</a> detectors.
</p>

<figure>
  {images/Triangle}
  <figcaption style="margin-top: 12px;">
  The circuit  constructing a triangle detector.
  The choice of which neurons in the previous layer to show is slightly cherrypicked for pedagogy.
  The six neurons with the highest magnitude weights to the triangle are shown, plus one other neuron with slightly weaker weights.
  (Left leaning edges have slightly higher weights than right ones, but it seemed more illustrative to show two of both.) Click on neurons to see the full weights.</figcaption>
</figure>

<p>
  However, in practice, these triangle detectors (and other angle units)  seem to often just be used as multi-edge detectors downstream,
  or in conjunction with many other units to detect convex boundaries.
</p>

<p style="margin-top:20px;">
  The selected circuits discussed above only scratch the surface of the intricate structure in <code>mixed3a</code>.
  Below, we provide a taxonomized overview of all of them:
</p>

{mixed3a}




<br>
<hr style="margin-top: 20px; margin-bottom: 100px;">
<br><br>

<h2 id="mixed3b"><code>mixed3b</code></h2>

<p>
<code>mixed3b</code> straddles two levels of abstraction.
On the one hand, it has some quite sophisticated features that don't really seem like they should be characterized as "early" or "low-level": object boundary detectors, early head detectors, and more sophisticated part of shape detectors.
On the other hand, it also has many units that still feel quite low-level, such as color center-surround units.
</p>


<p style="margin-top:20px;">
  <b id="mixed3b_discussion_boundary">Boundary detectors:</b> One of the most striking transitions in <code>mixed3b</code> is the formation of boundary detectors.
  When you first look at the feature visualizations and dataset examples,
  you might think these are just another iteration of edge or curve detectors.
  But they are in fact combining a variety of cues to detect boundaries and transitions between objects.
  Perhaps the most important one is the high-low frequency detectors we saw develop at the previous layer.
  Notice that it largely doesn't care which direction the change in color or frequency is, just that there's a change.
</p>


<figure style='image-rendering: pixelated;'>
  {images/Boundary}
</figure>

<p>
  We sometimes find it useful to think about the "goal" of early vision.
  Gradient descent will only create features if they are useful for features in later layers.
  Which later features incentivized the creation of the features we see in early vision?
  These boundary detectors seem to be the "goal" of the <a href="#group_mixed3a_high_low_frequency">high-low frequency detectors (<code>mixed3a</code>)</a> we saw in the previous layer.
</p>

<p style="margin-top:20px;">
  <b id="mixed3b_discussion_curve_based">Curve-based Features:</b>
  Another major theme in this layer is the emergence of more complex and specific shape detectors based on curves.
  These include more <a href="">sophisticated curves</a>,
  <a href="#group_mixed3b_circles_loops">circles</a>, <a href="#group_mixed3b_curve_shapes">S-shapes</a>, <a href="#group_mixed3b_curve_shapes">spirals</a>,
  <a href="#group_mixed3b_divots">divots</a>, and <a href="#group_mixed3b_evolute">"evolutes"</a>
  (a term we've repurposed to describe units detecting curves facing away from the middle).
  We'll discuss these in detail in a forthcoming article on curve circuits, but they warrant mention here.
</p>

<p>
  Conceptually, you can think of the weights as piecing together curve detectors as something like this:
</p>

<figure style='image-rendering: pixelated;'>
  {images/CurveBased}
</figure>

<p style="margin-top:20px;">
  <b id="mixed3b_discussion_fur">Fur detectors:</b> Another interesting (albeit, probably quite specific to the dog focus of ImageNet)
  circuit is the implementation of <a href="#group_mixed3b_generic_oriented_fur">"oriented fur detectors"</a> which detect fur parting, like hair on one's head.
  They're implemented by piecing together <a href="#group_mixed3a_fur_precursors">fur precursors (<code>mixed3a</code>)</a> so that they converge in a particular way.
</p>

<figure style='image-rendering: pixelated;'>
  {images/Fur}
</figure>

<p>
  Again, these circuits only scratch the surface of <code>mixed3b</code>.
  Since it's a larger layer with lots of families, we'll go through a couple particularly interesting and well understood families first:
</p>

{mixed3b_hipri}

<p>
  In addition to the above features, are also a lot of other features which don't fall into such a neat categorization.
  One frustrating issue is that <code>mixed3b</code> has many units that don't have a simple low-level articulation, but also are not yet very specific to a high-level feature.
  For example, there are units which seem to be developing towards detecting certain animal body parts, but still respond to many other stimuli as well and so are difficult to describe.
</p>


{mixed3b_lowpri}



<hr style="margin-top: 20px; margin-bottom: 100px;">
<br><br>

<h2 id="conclusion">Conclusion</h2>

<p>
  The goal of this essay was to give a high-level overview of our present understanding of early vision in InceptionV1.
  Every single feature discussed in this article is a potential topic of deep investigation.
  For example, are curve detectors really curve detectors? What types of curves do they fire for? How do they behave on various edge cases? How are they built?
  Over the coming articles, we'll do deep dives rigorously investigating these questions for a few features, starting with curves.
</p>

<p>
  Our investigation into early vision has also left us with many broader open questions.
  To what extent do these feature families reflect fundamental clusters in features,
  versus a taxonomy that might be helpful to humans but is ultimately somewhat arbitrary?
  Is there a better taxonomy, or another way to understand the space of features?
  Why do features often seem to form in families?
  To what extent do the same features families form across models?
  Is there a "periodic table of low-level visual features", in some sense?
  To what extent do later features admit a similar taxonomy?
  We think these could be interesting questions for future work.
</p>


<!--
<h2 id="open">Open Questions about Early Vision Neuron Groups</h2>

<p>
  <b>Are these features to </b>
</p>

<p>
  <b>Is there a "periodic table of low-level visual features"?</b>
  By this we mean
</p>

-->

<br>
<div id="thread-nav" class="thread-info" style="margin-top: 40px;">
    <div class="icon-multiple-pages"></div>
    <p class="explanation">
        This article is part of the Circuits thread, a collection of short articles and commentary by an open scientific collaboration delving into the inner workings of neural networks.<br>
        <!--<a style="border-bottom: none; color: #2e6db7; margin-left: 0px;">ðŸ”¬Learn how to get involved.</a>-->
        <!--<a class="overview" href="#">Thread Overview</a>-->
    </p>

    <a class="prev" href="https://distill.pub/2020/circuits/zoom-in/">Zoom In: An Introduction to Circuits</a>
    <div class="next" href="#" style="color:#999;">Curve Detectors
      <div style="color:#BBB; font-size: 90%; line-height: 140%; margin-top: 4px;">Under discussion in <a href="http://slack.distill.pub/">Distill slack</a> <code>#circuits</code></div>
    </div>
</div>

</d-article>
<d-appendix>
  <h3>Acknowledgments</h3>
  <p>
    Brice Menard, Sophia Sanborn, Nick Barry, Daniel Filan, Nick Moran, Joseph Abrahamson, Richard Meyes, David Valdman, Alex BÃ¤uerle, Chris Hallacy.
  </p>
  <d-footnote-list></d-footnote-list>
  <d-citation-list></d-citation-list>
</d-appendix>
<d-bibliography src="bibliography.bib"></d-bibliography>

</html>
